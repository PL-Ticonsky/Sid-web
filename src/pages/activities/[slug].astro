---
import BaseLayout from "../../layouts/BaseLayout.astro";
import { getCollection } from "astro:content";

const BASE = import.meta.env.BASE_URL;

export async function getStaticPaths() {
  const items = await getCollection("activities");
  return items.map((item) => ({
    params: { slug: item.slug },
    props: { item },
  }));
}

const { item } = Astro.props;
const { Content } = await item.render();

// Cover para GitHub Pages
const coverSrc =
  typeof item.data.cover === "string" && item.data.cover.startsWith("/")
    ? `${BASE}${item.data.cover.slice(1)}`
    : item.data.cover;

// Status / Date (control desde frontmatter)
const status = (item.data.status ?? "").toString().toLowerCase();
const dateLabel = item.data.date; // puede ser "2026-03-10" o "Marzo 2026"
const isComingSoon = status === "proximamente" || !!dateLabel;
---

<BaseLayout title={`SID · ${item.data.title}`}>
  <section class="space-y-10">
    <!-- Header -->
    <header class="space-y-5">
      {coverSrc && (
        <div class="overflow-hidden rounded-2xl border border-gray-200 bg-gray-100">
          <img
            src={coverSrc}
            alt={item.data.title}
            class="w-full max-h-[420px] object-cover"
            loading="eager"
          />
        </div>
      )}

      <div class="space-y-3">
        <div class="flex flex-wrap items-center gap-2">
          {item.data.type && (
            <span class="inline-flex items-center rounded-full bg-sid-purple/10 px-3 py-1 text-xs font-semibold text-sid-purple">
              {item.data.type}
            </span>
          )}

          {isComingSoon && (
            <span class="inline-flex items-center rounded-full bg-amber-500/10 px-3 py-1 text-xs font-semibold text-amber-700">
              {dateLabel ? dateLabel : "PRÓXIMAMENTE"}
            </span>
          )}
        </div>

        <h1 class="font-poppins text-4xl leading-tight text-sid-navy">
          {item.data.title}
        </h1>

        {item.data.formUrl && !isComingSoon && (
          <div class="pt-2">
            <a
              href={item.data.formUrl}
              target="_blank"
              rel="noopener noreferrer"
              class="inline-flex items-center justify-center rounded-xl bg-sid-pink px-5 py-2.5 text-sm font-semibold text-white hover:opacity-90 transition"
            >
              Participar
            </a>
          </div>
        )}

        {isComingSoon && (
          <p class="text-sm text-slate-600">
            Inscripciones y detalles estarán disponibles pronto.
          </p>
        )}
      </div>
    </header>

    <!-- Content -->
    <article class="space-y-4 leading-relaxed text-slate-700">
      <Content />
    </article>
  </section>
</BaseLayout>
