---
import BaseLayout from "../../layouts/BaseLayout.astro";
import { getCollection } from "astro:content";

const BASE = import.meta.env.BASE_URL;

export async function getStaticPaths() {
  const items = await getCollection("courses");
  return items.map((item) => ({
    params: { slug: item.data.slug ?? item.slug },
    props: { item },
  }));
}

const { item } = Astro.props;
const { Content } = await item.render();

const coverSrc =
  typeof item.data.cover === "string" && item.data.cover.startsWith("/")
    ? `${BASE}${item.data.cover.slice(1)}`
    : item.data.cover;
---

<BaseLayout title={`SID · ${item.data.title}`}>
  <section class="space-y-12">
    <header class="space-y-6">
      {coverSrc && (
        <div class="overflow-hidden rounded-2xl border border-gray-200 bg-gray-100">
          <img
            src={coverSrc}
            alt={item.data.title}
            class="w-full max-h-[420px] object-cover"
            loading="eager"
          />
        </div>
      )}

      <div class="space-y-3">
        <h1 class="font-poppins text-4xl leading-tight text-sid-navy">
          {item.data.title}
        </h1>

        {item.data.description && (
          <p class="text-slate-700 leading-relaxed max-w-3xl">
            {item.data.description}
          </p>
        )}

        <div class="flex flex-wrap gap-3 pt-2">
          {item.data.level && (
            <span class="inline-flex items-center rounded-full bg-sid-blue/10 px-3 py-1 text-xs font-semibold text-sid-blue">
              Nivel: {item.data.level}
            </span>
          )}
          {item.data.duration && (
            <span class="inline-flex items-center rounded-full bg-sid-purple/10 px-3 py-1 text-xs font-semibold text-sid-purple">
              Duración: {item.data.duration}
            </span>
          )}
        </div>
      </div>
    </header>

    {item.data.objectives?.length > 0 && (
      <section class="space-y-4">
        <h2 class="font-poppins text-2xl text-sid-navy">Objetivos</h2>
        <ul class="list-disc pl-6 space-y-2 text-slate-700">
          {item.data.objectives.map((o) => <li>{o}</li>)}
        </ul>
      </section>
    )}

    {item.data.prerequisites?.length > 0 && (
      <section class="space-y-4">
        <h2 class="font-poppins text-2xl text-sid-navy">Prerrequisitos</h2>
        <ul class="list-disc pl-6 space-y-2 text-slate-700">
          {item.data.prerequisites.map((p) => <li>{p}</li>)}
        </ul>
      </section>
    )}

    {item.data.syllabus?.length > 0 && (
      <section class="space-y-4">
        <h2 class="font-poppins text-2xl text-sid-navy">Temario</h2>

        <div class="space-y-4">
          {item.data.syllabus.map((m) => (
            <div class="rounded-2xl border border-gray-200 p-5 bg-white">
              <div class="font-poppins font-semibold text-lg text-sid-navy">
                {m.module}
              </div>

              {m.topics?.length > 0 && (
                <ul class="mt-3 list-disc pl-6 space-y-1 text-slate-700">
                  {m.topics.map((t) => <li>{t}</li>)}
                </ul>
              )}
            </div>
          ))}
        </div>
      </section>
    )}

    {item.data.resources?.length > 0 && (
      <section class="space-y-4">
        <h2 class="font-poppins text-2xl text-sid-navy">Recursos</h2>

        <div class="space-y-3">
          {item.data.resources.map((r) => (
            <a
              href={r.url}
              target="_blank"
              rel="noopener noreferrer"
              class="block rounded-2xl border border-gray-200 p-5 hover:shadow-md transition bg-white"
            >
              <div class="font-semibold text-sid-blue">{r.label}</div>
              {r.note && <div class="text-sm text-slate-600 mt-1">{r.note}</div>}
            </a>
          ))}
        </div>
      </section>
    )}

    <section class="space-y-4">
      <h2 class="font-poppins text-2xl text-sid-navy">Descripción</h2>
      <article class="space-y-4 leading-relaxed text-slate-700">
        <Content />
      </article>
    </section>
  </section>
</BaseLayout>
